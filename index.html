<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Organic Quest — Prototype</title>
  <style>
    :root{--bg:#0f1724;--card:#fff;--muted:#9aa4b2;--accent:#66b2ff}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#071020 0%,#072333 100%);font-family:Inter,system-ui,Arial}
    .app{display:grid;grid-template-columns:320px 1fr 320px;gap:18px;padding:18px;height:100vh;box-sizing:border-box}
    .panel{background:rgba(255,255,255,0.04);border-radius:12px;padding:14px;color:var(--card);box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    h2{margin:0 0 8px 0;font-size:18px}
    .deck{display:flex;flex-direction:column;gap:8px}
    .card{background:#fff;color:#071020;border-radius:10px;padding:10px;box-shadow:0 2px 6px rgba(2,6,23,0.2);cursor:pointer;user-select:none}
    .card .type{font-weight:700}
    .card.small{padding:6px;font-size:14px}
    .row{display:flex;gap:8px;align-items:center}
    .btn{background:var(--accent);border:none;color:#01273b;padding:8px 10px;border-radius:10px;font-weight:700;cursor:pointer}
    .muted{color:var(--muted);font-size:13px}
    .play-area{min-height:260px;border:2px dashed rgba(255,255,255,0.06);padding:12px;border-radius:10px;display:flex;flex-wrap:wrap;gap:8px;align-content:flex-start}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap}
    .mission{background:rgba(255,255,255,0.03);padding:10px;border-radius:8px}
    pre{white-space:pre-wrap;color:var(--muted);font-size:13px}
    .card.functional{background:#fde68a}
    .card.carbon{background:#e9d5ff}
    .card.special{background:#fca5a5}
    footer{font-size:13px;color:var(--muted);padding:10px;text-align:center}
  </style>
</head>
<body>
  <div class="app">
    <section class="panel">
      <h2>Decks & Controls</h2>
      <div class="deck">
        <div class="row"><button id="drawCarbon" class="btn">จั่วการ์ดคาร์บอน</button><span class="muted">(C-tiles)</span></div>
        <div id="carbonCount" class="muted">คงเหลือ: </div>
        <hr>
        <div class="row"><button id="drawFunctional" class="btn">จั่วหมู่ฟังก์ชัน</button><span class="muted">(Functional groups)</span></div>
        <div id="functionalCount" class="muted">คงเหลือ: </div>
        <hr>
        <div class="row"><button id="drawEvent" class="btn">จั่วการ์ดเหตุการณ์</button><span class="muted">(Events)</span></div>
        <div id="eventLog" class="muted">เหตุการณ์ล่าสุด: -</div>
        <hr>
        <div class="row"><button id="newMission" class="btn">เริ่มภารกิจใหม่</button><button id="resetGame" class="btn">รีเซ็ต</button></div>
      </div>
      <hr>
      <h2>อินสตรัคชันด่วน</h2>
      <pre>
- จั่วการ์ดคาร์บอนเพื่อเพิ่มโครงหลัก (C1,C2,...)
- จั่วหมู่ฟังก์ชัน เช่น OH, C=O, COOH
- วางการ์ดลงใน Play Area โดยคลิกการ์ด
- ตรวจภารกิจเมื่อพร้อม (ปุ่ม Check)
      </pre>
    </section>

    <main class="panel">
      <h2>Play Area</h2>
      <div class="row toolbar">
        <button id="checkMission" class="btn">ตรวจภารกิจ</button>
        <button id="undo" class="btn">ยกเลิกการ์ดล่าสุด</button>
        <div class="muted">คะแนน: <span id="score">0</span></div>
      </div>
      <div style="height:12px"></div>
      <div id="playArea" class="play-area" aria-label="Play area"></div>
      <div style="height:12px"></div>
      <h3 class="muted">การ์ดที่วางแล้ว (ลำดับสำคัญ)</h3>
      <div id="placedList" class="muted">- (ยังไม่มีการ์ด)</div>

      <hr>
      <h3>คู่มือการเล่น (สรุป)</h3>
      <pre>
1) จั่วภารกิจ > จั่วการ์ดคาร์บอนและหมู่ฟังก์ชัน
2) วางการ์ดให้สอดคล้องกับภารกิจ (ตัวอย่าง: "กรดคาร์บอกซิลิก 3C" ต้องมี C3 + COOH)
3) กด ตรวจภารกิจ เพื่อรับคะแนน
4) ระวังการ์ดเหตุการณ์ที่อาจเปลี่ยนพันธะหรือสลายหมู่
      </pre>
    </main>

    <aside class="panel">
      <h2>ภารกิจ & ตัวอย่างการ์ด</h2>
      <div class="mission">
        <strong>ภารกิจปัจจุบัน:</strong>
        <div id="missionText">(ยังไม่มีภารกิจ)</div>
        <div class="muted" style="margin-top:6px">คำอธิบาย: สร้างโมเลกุลที่ตรงกับเงื่อนไข</div>
      </div>

      <h3 style="margin-top:12px">ตัวอย่างการ์ดหมู่ฟังก์ชัน</h3>
      <div id="sampleFunctional"></div>

      <h3 style="margin-top:12px">ตัวอย่างการ์ดคาร์บอน</h3>
      <div id="sampleCarbon"></div>

      <h3 style="margin-top:12px">รายละเอียดคะแนน</h3>
      <pre>
- ภารกิจสำเร็จตรงตามเงื่อนไข: +10
- ภารกิจสำเร็จแบบใกล้เคียง: +5
- ผิดเงื่อนไข: 0
      </pre>
    </aside>
  </div>
  <footer class="muted">Organic Quest — Prototype | มีหมู่ฟังก์ชันอย่างน้อย 6 หมู่ (Alkane/Alkene/Alkyne/Alcohol/Ketone/Carboxylic acid)</footer>

  <script>
    const carbonDeck = [];
    for(let i=1;i<=6;i++) carbonDeck.push({type:'carbon',label:'C'+i,carbons:i,id:'C'+i});

    const functionalDeck = [
      {type:'functional',label:'–OH (Alcohol)',id:'OH',group:'alcohol'},
      {type:'functional',label:'C=O (Ketone)',id:'C=O',group:'ketone'},
      {type:'functional',label:'C\u2261C (Alkyne)',id:'≡',group:'alkyne'},
      {type:'functional',label:'C=C (Alkene)',id:'=',group:'alkene'},
      {type:'functional',label:'–COOH (Carboxylic acid)',id:'COOH',group:'acid'},
      {type:'functional',label:'(Alkane backbone)',id:'alkane',group:'alkane'}
    ];

    const eventDeck = [
      {type:'event',label:'สลายพันธะ (Break bond)',id:'break'},
      {type:'event',label:'เพิ่มพันธะคู่ (Form double bond)',id:'double'},
      {type:'event',label:'ไอโซเมอร์ (Isomerize)',id:'iso'}
    ];

    const missions = [
      {text:'สร้างกรดคาร์บอกซิลิกที่มี 3 คาร์บอน', require:{carbons:3,functional:'acid'},score:10},
      {text:'สร้างแอลกอฮอล์ที่มี 2 คาร์บอน', require:{carbons:2,functional:'alcohol'},score:10},
      {text:'สร้างคีโตนที่มี 4 คาร์บอน', require:{carbons:4,functional:'ketone'},score:10},
      {text:'สร้างสารที่มีพันธะคู่และ 3 คาร์บอน', require:{carbons:3,functional:'alkene'},score:10}
    ];

    let state = {carbonDeck:[],functionalDeck:[],eventDeck:[],playArea:[],score:0,currentMission:null,eventLog:'-'};

    function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a}

    function reset(){state.carbonDeck=shuffle([...carbonDeck]);state.functionalDeck=shuffle([...functionalDeck]);state.eventDeck=shuffle([...eventDeck]);state.playArea=[];state.score=0;state.currentMission=null;state.eventLog='-';renderAll();}

    function renderAll(){
      document.getElementById('carbonCount').textContent='คงเหลือ: '+state.carbonDeck.length;
      document.getElementById('functionalCount').textContent='คงเหลือ: '+state.functionalDeck.length;
      document.getElementById('eventLog').textContent='เหตุการณ์ล่าสุด: '+state.eventLog;
      renderPlayArea();
      renderSamples();
      renderMission();
      document.getElementById('score').textContent=state.score;
    }

    function renderPlayArea(){
      const el=document.getElementById('playArea');
      el.innerHTML='';
      if(state.playArea.length===0){el.innerHTML='<div class="muted">(ยังไม่มีการ์ด) คลิกการ์ดเพื่อวาง</div>'}else{
        state.playArea.forEach((c,i)=>{
          const div=document.createElement('div');
          div.className='card '+(c.type==='functional'?'functional':c.type==='carbon'?'carbon':'special')+' small';
          div.textContent=c.label;
          div.title='คลิกเพื่อลบ';
          div.onclick=()=>{if(confirm('ต้องการลบการ์ดนี้หรือไม่?')){state.playArea.splice(i,1);renderAll()}}
          el.appendChild(div);
        })
      }
      document.getElementById('placedList').textContent=state.playArea.map(x=>x.label).join(' • ')||'-';
    }

    function renderSamples(){
      const sf=document.getElementById('sampleFunctional');sf.innerHTML='';functionalDeck.forEach(f=>{const d=document.createElement('div');d.className='card small functional';d.textContent=f.label;sf.appendChild(d)});
      const sc=document.getElementById('sampleCarbon');sc.innerHTML='';for(let i=1;i<=6;i++){const d=document.createElement('div');d.className='card small carbon';d.textContent='C'+i;sc.appendChild(d)}
    }

    function renderMission(){document.getElementById('missionText').textContent=state.currentMission?state.currentMission.text:'(ยังไม่มีภารกิจ)'}

    function drawCarbon(){const card=state.carbonDeck.shift();if(!card){alert('ไม่มีการ์ดคาร์บอนแล้ว');return}state.playArea.push(card);renderAll()}
    function drawFunctional(){const card=state.functionalDeck.shift();if(!card){alert('ไม่มีการ์ดหมู่ฟังก์ชันแล้ว');return}state.playArea.push(card);renderAll()}
    function drawEvent(){const e=state.eventDeck.shift();if(!e){alert('ไม่มีการ์ดเหตุการณ์แล้ว');return}state.eventLog=e.label;applyEvent(e);renderAll()}

    function applyEvent(e){
      if(e.id==='break'){const idx=state.playArea.findIndex(x=>x.type==='functional');if(idx>=0){state.playArea.splice(idx,1);state.eventLog+=' → เอาหนึ่งหมู่ฟังก์ชันออก'}else{state.eventLog+=' → ไม่มีหมู่ให้สลาย'}}
      if(e.id==='double'){const f=state.playArea.find(x=>x.id==='alkane');if(f){f.id='=';f.group='alkene';f.label='C=C (Alkene)';state.eventLog+=' → เปลี่ยน alkane เป็น alkene'}else{state.eventLog+=' → ไม่มี alkane ให้เปลี่ยน'}}
      if(e.id==='iso'){if(state.playArea.length>=2){const i=0,j=state.playArea.length-1;[state.playArea[i],state.playArea[j]]=[state.playArea[j],state.playArea[i]];state.eventLog+=' → เกิดไอโซเมอร์ (สลับลำดับ)'}else{state.eventLog+=' → ไม่มีการสลับ'}}
    }

    function newMission(){state.currentMission = missions[Math.floor(Math.random()*missions.length)];renderAll()}

    function checkMission(){
      if(!state.currentMission){alert('ยังไม่มีภารกิจ! กด เริ่มภารกิจใหม่');return}
      let totalC=0;
      let hasFunc=false;
      state.playArea.forEach(c=>{if(c.type==='carbon') totalC+=c.carbons||0;if(c.type==='functional' && c.group===state.currentMission.require.functional) hasFunc=true});
      let earned=0;
      let msg='';
      if(totalC===state.currentMission.require.carbons && hasFunc){earned=state.currentMission.score;msg='สำเร็จตรงเงื่อนไข! ได้ '+earned+' คะแนน'}
      else if(totalC>=state.currentMission.require.carbons && hasFunc){earned=Math.floor(state.currentMission.score/2);msg='ใกล้เคียง (carbons >= เงื่อนไข และมี func) ได้ '+earned+' คะแนน'}
      else{msg='ไม่ผ่านเงื่อนไข'}
      state.score+=earned;
      alert(msg+'\nคะแนนรวม: '+state.score);
      state.currentMission=null;
      newMission();
      renderAll();
    }

    document.getElementById('drawCarbon').onclick=drawCarbon;
    document.getElementById('drawFunctional').onclick=drawFunctional;
    document.getElementById('drawEvent').onclick=drawEvent;
    document.getElementById('newMission').onclick=newMission;
    document.getElementById('resetGame').onclick=()=>{if(confirm('รีเซ็ตเกม?'))reset()};
    document.getElementById('checkMission').onclick=checkMission;
    document.getElementById('undo').onclick=()=>{if(state.playArea.length){state.playArea.pop();renderAll()}else alert('ไม่มีการ์ดให้ย้อนกลับ')}

    reset();
  </script>
</body>
</html>
